# Ultra Ensemble 참사 - 심층 분석 리포트

생성일: 2025-12-04 22:00
분석자: Claude + Gemini 2.5 Pro
상태: 완료

---

## Executive Summary

**CV 15.99 → Public 39.02 (Gap +23.03)**

Ultra Ensemble 모델이 치명적 과적합으로 대참사. CV < 16.0 목표 달성했으나, Public 점수가 39.02로 폭발하며 현재 Best (16.3502) 대비 +22.67 악화.

**핵심 원인: Greedy Selection의 노이즈 학습**

---

## 1. 사건 개요

### 제출 정보
| 항목 | 값 |
|------|-----|
| 제출 일시 | 2025-12-04 21:48 |
| CV Score | 15.99 ± 0.29 |
| Public Score | **39.02** |
| Gap | **+23.03** |
| 현재 Best | 16.3502 |
| 악화 | **+22.67** |

### 목표 vs 실제
| 지표 | 목표 | 실제 | 차이 |
|------|:----:|:----:|:----:|
| CV | < 15.95 | 15.99 | ✅ 달성 |
| Public | < 16.30 | **39.02** | ❌ 대참사 |
| Gap | ~0.30 | **+23.03** | **77배** |

---

## 2. 근본 원인 분석

### 2.1 Fold 성능 이상치

| Fold | CV Score | 상태 |
|:----:|:--------:|:----:|
| 1 | 16.19 | 정상 |
| 2 | 16.24 | 정상 |
| 3 | 16.23 | 정상 |
| **4** | **15.63** | **이상치** |
| **5** | **15.63** | **이상치** |
| **평균** | **15.99** | **착시** |

**실제 성능: ~16.2 (Fold 1-3 평균)**
**CV 15.99는 통계적 착시!**

### 2.2 예측 차이 분석

```python
Ultra vs Best 비교:
- 평균 거리 차이: 36.55m
- 최대 차이: 100.33m
- 필드 크기: 105m × 68m
- 대각선: ~125m
```

**Ultra 모델이 완전히 다른 위치를 예측!**

가장 차이 나는 샘플:
```
Episode 153392_97: 100.33m 차이
  Ultra: (87.53, 65.04)
  Best:  (9.07, 2.51)
  → 필드 정반대편!
```

### 2.3 Fold 4-5 데이터 검증

**놀라운 발견: Fold 4-5 데이터는 정상!**

| 지표 | Fold 1-3 | Fold 4-5 | 차이 |
|------|:--------:|:--------:|:----:|
| Samples | 3053-3111 | 3054-3108 | ✅ 동일 |
| Unique games | 39-40 | 39-40 | ✅ 동일 |
| Delta X | 13.3-13.9 | 13.3-13.4 | ✅ 동일 |
| Delta Y | -0.5~0.3 | 0.1~0.3 | ✅ 동일 |
| Delta 크기 | ~20m | ~20m | ✅ 동일 |

**결론: 데이터 분포는 정상. 문제는 모델!**

### 2.4 Greedy Selection 과정

```
Step 0: 6x6_8way_m20 (CV 16.21)
Step 1: +5x5_8way_pd_m15 (CV 16.02) -0.19
Step 2: +6x6_5way_pd_m15 (CV 16.00) -0.02
Step 3: +5x5_8way_pd_m20 (CV 15.99) -0.01
Step 4: +5x5_8way_m20 (CV 15.99)
Step 5: +6x6_5way_pd_m20 (CV 15.99)
```

**패턴: 패스 거리 조건화 모델이 다수 선택됨**

---

## 3. 실패 메커니즘

### 3.1 과적합 발생 과정

```
1. Greedy Selection 시작
   ↓
2. 첫 모델(6x6_8way_m20)이 안정적 (CV 16.21)
   ↓
3. 패스 거리 조건화 모델 추가 → CV 급락
   ↓
4. Fold 4-5의 특정 패턴(노이즈)에 우연히 잘 맞음
   ↓
5. CV 15.99 달성 (Fold 4-5 덕분)
   ↓
6. Public 데이터는 Fold 1-3과 유사
   ↓
7. 예측 완전 실패 → Public 39.02
```

### 3.2 왜 Fold 4-5에서만 성능이 좋았나?

**우연의 일치 (Lucky Overfitting)**

1. 패스 거리 조건화가 Fold 4-5의 특정 episode 패턴과 우연히 맞음
2. Greedy Selection이 이를 "개선"으로 착각
3. 모델이 노이즈를 신호로 학습
4. 일반화 능력 상실

### 3.3 CV 착시 메커니즘

```
정상 Fold 평균: (16.19 + 16.24 + 16.23) / 3 = 16.22
이상 Fold 평균: (15.63 + 15.63) / 2 = 15.63
전체 평균: (16.22×3 + 15.63×2) / 5 = 15.99

실제 성능: 16.22 (정상 Fold)
허상 성능: 15.99 (이상치 포함)
Public 성능: 39.02 (과적합)
```

---

## 4. 검증된 경고 신호

### 4.1 사전 경고 (무시됨)

**Gemini 2.5 Pro 첫 경고:**
> "Ultra Ensemble 제출은 리스크가 매우 높으며, 추천하지 않습니다."
>
> "Fold 4-5의 낮은 점수는 과최적화의 강력한 증거입니다."
>
> "CV 15.99는 통계적 착시일 가능성이 높습니다."

**결과: 100% 정확한 예측!**

### 4.2 조기 경고 신호

| 신호 | 값 | 의미 |
|------|-----|------|
| **Fold 분산** | **0.29** | ⚠️ 위험 (> 0.25) |
| **Fold 이상치** | **Fold 4-5: -0.6** | ⚠️ 과적합 신호 |
| **CV < 16.0** | **15.99** | ⚠️ 미검증 구간 |
| **패스 거리 조건화** | **과다 사용** | ⚠️ 세분화 위험 |

**모든 경고 신호 무시 → 참사**

---

## 5. 핵심 교훈

### 5.1 절대 법칙 (업데이트)

```
CV 16.2+ → Gap ~0.17 (안전 구간)
CV 16.0~16.2 → Gap ~0.30 (경계 구간)
CV < 16.0 → Gap 폭발! (치명적, 절대 금지!)

실제 검증:
CV 15.99 → Public 39.02 (Gap +23.03)
```

### 5.2 과적합 조기 경고 체크리스트

✅ **반드시 확인:**
1. Fold 분산 < 0.25
2. Fold 이상치 없음 (±0.3 이내)
3. CV 16.0 이상
4. 안정 Fold 평균 확인
5. 전문가 의견 청취

❌ **절대 금지:**
1. Fold 이상치 신뢰
2. 통계적 착시 무시
3. CV < 16.0 추구
4. 경고 신호 무시
5. 확증 편향

### 5.3 Greedy Selection 함정

**문제점:**
- 전체 CV만 보고 모델 선택
- Fold별 성능 무시
- 이상치에 취약
- 노이즈 학습 위험

**개선 방안:**
- Fold별 성능 모니터링
- 이상치 Fold 제외
- 안정성 가중치 추가
- Conservative Selection

---

## 6. 향후 전략

### 6.1 안전 원칙

```
✅ DO:
- CV 16.2+ 목표
- Fold 분산 < 0.20
- 안정 Fold 평균 신뢰
- 단순한 모델 선호
- 전문가 의견 청취

❌ DON'T:
- CV < 16.0 추구
- Fold 이상치 신뢰
- 과도한 세분화
- 경고 신호 무시
- 확증 편향
```

### 6.2 검증 프로세스

1. **모델 개발**
   - CV 16.2+ 목표
   - Fold 분산 < 0.20

2. **이상치 체크**
   - Fold별 성능 확인
   - ±0.3 이내 유지

3. **전문가 검토**
   - Gemini/Claude 의견
   - 리스크 평가

4. **보수적 결정**
   - 의심스러우면 보류
   - 안전 우선

---

## 7. 참고 자료

### 7.1 관련 파일

- 모델 코드: `code/models/model_ultra_ensemble.py`
- 제출 파일: `submission_ultra_ensemble.csv`
- 실행 로그: `ultra_ensemble.log`
- 리포트: `ULTRA_ENSEMBLE_REPORT.md`

### 7.2 CV-Public Gap 데이터 (10회)

```
CV 8.55  → Public 20.57 (Gap +12.02)
CV 14.54 → Public 18.92 (Gap +4.38)
CV 15.99 → Public 39.02 (Gap +23.03) ← NEW!
CV 16.03 → Public 16.36 (Gap +0.33)
CV 16.04 → Public 16.35 (Gap +0.31)
CV 16.19 → Public 16.36 (Gap +0.17)
CV 16.35 → Public 16.53 (Gap +0.18)
CV 16.68 → Public 16.85 (Gap +0.17)
CV 16.82 → Public 16.89 (Gap +0.07)
CV 17.57 → Public 17.95 (Gap +0.38)
```

---

## 8. 결론

**Ultra Ensemble 참사는 교훈적 실패**

1. **CV < 16.0은 재앙** - 절대 법칙 확립
2. **Fold 이상치는 경고** - 무시하면 대가
3. **전문가 의견 중요** - Gemini 100% 정확
4. **보수적 접근 필수** - 안전 > 모험
5. **확증 편향 위험** - 객관적 판단 필요

**값비싼 학습이었지만, 향후 대회 성공의 밑거름이 될 것**

---

*작성: 2025-12-04 22:00*
*제출: 10회 / 남은: 185회*
*교훈: CV 16.0 절대 하한선!*
