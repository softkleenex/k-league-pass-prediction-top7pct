# K리그 패스 좌표 예측 - 패스 거리 모델 분석

**날짜**: 2025-12-04
**분석자**: Data Scientist Agent

---

## 실행 요약

패스 거리 조건화 전략을 탐색하여 3가지 모델을 개발했습니다:

| 모델 | CV | 안전성 | 제출 권장 |
|------|:--:|:-----:|:--------:|
| **Distance (보수적)** | **16.2815** | ✅ 안전 | **권장** |
| Distance (6x6 단독) | 16.2275 | ✅ 안전 | 권장 |
| Distance (앙상블) | 15.9970 | ❌ 위험 | 보류 |

---

## 핵심 발견

### 1. 패스 거리 분포

```
Min:    0.00m
Max:    71.17m
Median: 9.19m
Mean:   11.63m
```

대부분의 패스가 짧은 거리 (< 15m)에서 발생하므로, 거리 카테고리가 유의미한 구분 요인입니다.

### 2. 모델 비교

#### A. 기본 모델 (8방향 + 3단계 거리)
- 구조: 8방향 × 3단계 거리 = 24개 그룹
- CV 결과:
  - 5x5: 16.2956 ± 0.2367
  - 6x6: 16.2275 ± 0.2800 ✅
  - 7x7: 16.4412 ± 0.2617
- 문제점: 앙상블 시 CV 15.9970으로 급락 (과적합)

#### B. 보수적 모델 (5방향 + 2단계 거리)
- 구조: 5방향 × 2단계 거리 = 10개 그룹
- 높은 min_samples (30-40)
- CV 결과:
  - 5x5: 16.3649 ± 0.2620
  - 6x6: 16.2815 ± 0.3207 ✅
  - 7x7: 16.4126 ± 0.2926
- 장점: CV 16.2+ 안정적 유지

### 3. CV-Public Gap 예측

기존 8회 제출 데이터 분석:

```
CV 16.03 → Public 16.36 (Gap +0.33)  [8방향 모델]
CV 16.19 → Public 16.36 (Gap +0.17)  [5방향 앙상블]
CV 16.35 → Public 16.53 (Gap +0.18)  [5방향 단독]

패턴:
- CV 16.2+ → Gap ~0.17-0.20 (안정)
- CV 16.0-16.2 → Gap ~0.30-0.35 (증가)
- CV < 16.0 → Gap 급증
```

**Distance 보수적 모델 예측**:
- CV: 16.2815
- 예상 Gap: +0.17-0.25
- **예상 Public: 16.43-16.53**

---

## 모델 상세 분석

### 보수적 모델 아키텍처

```python
# 1. 거리 분류 (2단계 - 단순화)
def get_pass_distance_category(distance):
    if distance < 15:
        return 'short'  # 짧은 패스
    else:
        return 'long'   # 긴 패스

# 2. 방향 분류 (5방향 - 안정성 우선)
def get_direction_5way(prev_dx, prev_dy):
    # none, forward, up, backward, down

# 3. 계층적 Fallback
Level 3: Zone + Direction + Distance (threshold=40)
  ↓ (데이터 부족 시)
Level 2: Zone + Direction (threshold=30)
  ↓ (데이터 부족 시)
Level 1: Zone only (항상 사용 가능)
```

### 과적합 방지 전략

1. **높은 min_samples**
   - Level 3: 40개 이상
   - Level 2: 30개 이상
   - 기존 모델 대비 2배 높음

2. **단순한 분류**
   - 8방향 → 5방향 (그룹 수 감소)
   - 3단계 거리 → 2단계 거리
   - 총 24개 그룹 → 10개 그룹

3. **강력한 Fallback**
   - 3단계 계층 구조
   - 데이터 부족 시 자동으로 단순한 모델로 전환

---

## Fold별 성능 분석

### 보수적 모델 (6x6)

| Fold | CV Score | 비고 |
|:----:|:--------:|------|
| 1 | 16.4423 | 안정 |
| 2 | 16.5143 | 안정 |
| 3 | 16.6529 | 안정 |
| 4 | 15.8569 | 변동 (특정 게임 패턴?) |
| 5 | 15.9412 | 변동 |
| **평균** | **16.2815** | **✅ 안전** |

Fold 4, 5에서 약간 낮은 점수를 보이지만, 평균은 안전 구간 유지.

### 기본 모델 (6x6)

| Fold | CV Score | 비고 |
|:----:|:--------:|------|
| 1 | 16.4556 | 보수적과 유사 |
| 2 | 16.4668 | 보수적과 유사 |
| 3 | 16.4457 | 더 좋음 |
| 4 | 15.8899 | 더 좋음 |
| 5 | 15.8794 | 더 좋음 |
| **평균** | **16.2275** | **✅ 안전** |

기본 모델이 약간 더 낮은 CV를 보이지만, 앙상블 시 과적합 문제 발생.

---

## 제출 권장사항

### 우선순위 1: Distance 보수적 모델 ✅

**파일**: `/mnt/c/LSJ/dacon/dacon/kleague-algorithm/submission_pass_distance_conservative.csv`

- **CV**: 16.2815 ± 0.3207
- **예상 Public**: 16.43-16.53
- **Gap**: +0.15-0.25
- **안전성**: ✅ 높음 (CV >= 16.2)
- **장점**:
  - 안전 구간에서 패스 거리 정보 활용
  - 높은 threshold로 과적합 방지
  - 단순한 구조로 안정성 확보

**제출 시나리오**:
- 현재 Best (16.3574) 대비 예상: 16.45-16.50
- 개선 가능성: 낮음 (0.0-0.1 악화)
- 리스크: 낮음 (안전 구간)

### 우선순위 2: Distance 6x6 단독

**파일**: `/mnt/c/LSJ/dacon/dacon/kleague-algorithm/submission_pass_distance_6x6_only.csv`

- **CV**: 16.2275 ± 0.2800
- **예상 Public**: 16.40-16.48
- **Gap**: +0.17-0.25
- **안전성**: ✅ 높음
- **장점**:
  - 더 낮은 CV
  - 8방향 사용으로 더 세밀한 구분

**제출 시나리오**:
- 현재 Best 대비 예상: 16.40-16.48
- 개선 가능성: 중간 (0.0-0.05 개선 가능)
- 리스크: 낮음 (안전 구간)

### 제출 보류: Distance 앙상블 ❌

**파일**: `/mnt/c/LSJ/dacon/dacon/kleague-algorithm/submission_pass_distance.csv`

- **CV**: 15.9970 ± 0.2634
- **예상 Public**: > 16.50
- **안전성**: ❌ 위험 (CV < 16.0)
- **문제**: 앙상블 시 CV 급락 (과적합 신호)

---

## 핵심 교훈

### 1. 그룹 세분화의 양날의 검

```
많은 그룹 (24개) → CV 낮음 → 앙상블 과적합
적은 그룹 (10개) → CV 안정 → 앙상블 안전
```

패스 거리 정보는 유용하지만, 너무 세밀하게 나누면 과적합 위험.

### 2. min_samples의 중요성

```
threshold=20-25 → CV 16.22 → 앙상블 15.99 (과적합)
threshold=30-40 → CV 16.28 → 단독 사용 (안정)
```

높은 threshold가 CV는 약간 손해지만 Gap 안정성 확보.

### 3. 앙상블 vs 단독 모델

```
앙상블: 여러 Zone 조합 → CV 개선 but Gap 증가 위험
단독: 단일 최적 Zone → CV 약간 높음 but Gap 안정
```

CV < 16.2일 때는 앙상블보다 단독 모델이 안전.

### 4. 패스 거리는 유의미하지만 신중해야

```
거리 정보 활용:
  ✅ 2단계 분류 (short/long)
  ✅ 높은 threshold (30-40)
  ✅ 강력한 Fallback
  ❌ 3단계 분류 (과적합 위험)
  ❌ 낮은 threshold (과적합 위험)
```

---

## 다음 단계 제안

### A. 즉시 제출 가능 (안전)

1. **Distance 보수적**: CV 16.28, 예상 16.45-16.50
2. **Distance 6x6 단독**: CV 16.23, 예상 16.40-16.48

둘 다 안전하지만 현재 Best (16.3574) 대비 개선 가능성 낮음.

### B. 추가 탐색 방향

1. **필드 영역 기반 모델**
   - 공격/중간/수비 영역별 다른 전략
   - 예상 CV: 16.2-16.4

2. **시퀀스 길이 조건화**
   - 짧은/중간/긴 시퀀스 구분
   - 예상 CV: 16.1-16.3

3. **앙상블 개선**
   - CV 16.2+ 모델들만 앙상블
   - 가중치 최적화

### C. 제출 전략

**오늘 남은 제출: 2회**

**Option 1 (안전)**: 두 모델 모두 제출
- Distance 보수적 (안전 우선)
- Distance 6x6 단독 (성능 우선)
- 예상: 둘 다 16.40-16.50 범위

**Option 2 (탐색)**: 1개만 제출, 1개 보류
- Distance 6x6 단독 제출
- 다른 방향 탐색 후 비교

**권장**: Option 2
- 이유: 현재 Best 대비 개선 가능성 낮음
- 더 좋은 아이디어 탐색 후 제출

---

## 기술 통찰

### 패스 거리의 예측력

패스 거리는 다음 패스 위치 예측에 유의미:

```
짧은 패스 (< 15m):
  - 주로 중앙 밀집 지역
  - 좁은 분포 (표준편차 작음)

긴 패스 (>= 15m):
  - 넓은 공간으로 전환
  - 넓은 분포 (표준편차 큼)
```

하지만 과도한 세분화는 과적합 유발.

### 최적 분류 전략

```
방향: 5방향 (90도 간격) > 8방향 (45도 간격)
거리: 2단계 (15m 기준) > 3단계 (10m, 25m 기준)
```

단순함이 안정성을 가져옴.

---

## 결론

패스 거리 조건화는 유의미하지만:

1. **성능 개선**: 미미함 (CV 16.03 → 16.23-16.28)
2. **안전성**: 높음 (CV 16.2+ 유지)
3. **제출 권장**: 보류
   - 현재 Best 대비 개선 가능성 낮음
   - 다른 방향 탐색 우선

**최종 권장**: Distance 6x6 단독 모델을 백업으로 보유하고, 다른 전략 탐색 후 비교 제출.

---

*분석 완료: 2025-12-04*
