# OOD Impact Quantification - Executive Summary

**생성일:** 2025-12-16
**분석자:** Data Analyst Agent
**목적:** Zone 6x6 성공 이유 규명 및 Gap 예측 가이드라인 제시

---

## TL;DR (3줄 요약)

1. **Zone 6x6 = 최적해** - CV 16.34, Public 16.36 (Gap 0.028), 게임 간 변동성 9.47%
2. **단순성 > 복잡성** - 288 파라미터로 충분, 복잡한 모델 = Gap 폭발 (LSTM: Gap 2.9-6.9)
3. **위치 통계 = OOD 강인** - 축구의 물리적 법칙 활용, 시간 불변 패턴 학습

---

## 핵심 발견

### 1. 게임 간 변동성: 9.47% (매우 안정적)

Leave-One-Game-Out CV로 198개 게임 개별 평가 결과:
- **평균 CV:** 16.20
- **표준편차:** 1.53
- **변동계수 (CoV):** 9.47% ← **매우 안정적 (<10%)**

**해석:**
- CoV < 5% = 매우 안정적
- CoV < 10% = 안정적 ✅ Zone 6x6
- CoV > 15% = 불안정

Zone 6x6는 **어떤 게임에서도 일관된 성능**을 보임.

### 2. OOD 성능 저하: -0.044 (거의 없음)

| 방법 | 평균 CV | 설명 |
|------|---------|------|
| GroupKFold (5-fold) | 16.245 | 기존 방식 (게임 섞임) |
| LOGO (완전 OOD) | 16.201 | 198개 게임 개별 평가 |
| **차이** | **-0.044** | **오히려 약간 향상!** |

**해석:**
- LOGO < GKF = 모델이 **범용 패턴** 학습 (게임 특화 X)
- 새로운 게임에서도 **성능 저하 없음**
- **OOD 강인성 증명** ✅

### 3. 모델 복잡도와 Gap의 강한 양의 상관관계

| 모델 | 파라미터 | CV | Public | Gap | Gap/Params |
|------|----------|-----|--------|-----|-----------|
| **Zone 6x6** | **288** | **16.34** | **16.36** | **0.028** | **9.8e-5** |
| Zone 8x8 | 512 | 16.29 | 16.52 | 0.223 | 43.6e-5 |
| Phase 2 LGBM | ~1,000 | 15.38 | 16.81 | 1.43 | 143.0e-5 |
| LSTM v5 | 12,700 | 14.44 | 17.44 | 3.00 | 236.2e-5 |
| LSTM v3 | 50,000 | 14.36 | 17.29 | 2.93 | 58.6e-5 |
| LSTM v2 | 50,000 | 13.18 | 20.08 | 6.90 | 138.0e-5 |

**상관계수:**
- 파라미터 수 vs Gap: **+0.789** (강한 양의 상관)
- CV vs Gap: **-0.979** (강한 음의 상관)

**해석:**
- 복잡할수록 Gap 증가 (과적합 → OOD 취약)
- CV가 낮아도 Gap이 크면 무의미 (LSTM v2: CV 13.18 → Public 20.08)
- **단순성 = 안정성 = OOD 강인성**

---

## 접근법별 Gap 통계

### Zone 접근법 (14개 실험)
- **평균 Gap:** 0.149 ± 0.062
- **범위:** 0.028 - 0.279
- **최적:** Zone 6x6 (Gap 0.028)

### GBDT+Features (1개 실험)
- **평균 Gap:** 1.430
- **Phase 2 실패 원인:** 복잡한 피처 엔지니어링 → 학습 데이터 특화

### Deep Learning (3개 실험)
- **평균 Gap:** 4.277 ± 2.272
- **범위:** 2.930 - 6.900
- **실패 원인:** 시퀀스 패턴 → 게임별 특성 과적합

---

## Gap 예측 모델

### Zone 접근법 기준 (안정적)

```
Gap = 18.5518 - 1.1274 * CV
R² = 0.436
```

**실용 가이드라인:**
```
예상 Public = CV + 0.02 ~ 0.15
안전 범위: CV + 0.10 ± 0.05
```

**현재 모델 검증 (Zone 6x6):**
- CV: 16.3356
- 예측 Gap: 0.1355
- 예측 Public: 16.4711
- **실제 Public: 16.3639** ✅
- 예측 오차: 0.1072 (허용 범위 내)

### Complex 모델 (불안정)
```
예상 Public = CV + 1.0 ~ 7.0 (예측 불가)
사용 권장하지 않음 ❌
```

---

## 왜 Zone 6x6가 성공했는가?

### 1. 위치 통계의 안정성
- 축구장 물리적 구조 = 불변
- 위치별 패스 패턴 = 시간에 따라 안정적
- **새로운 게임 ≈ 동일한 위치 통계**

### 2. 과적합 방지
- 288 파라미터 = 6x6 zones × 8 directions × 2 coords
- 각 파라미터 = 25개 이상 샘플로 학습
- **충분한 일반화 능력**

### 3. 계층적 Fallback
```
Zone+Direction → Zone only → Global
```
- 데이터 부족 시 자동 일반화
- 안정성 향상

### 4. 중위수 (Median) 사용
- 이상치에 강인
- 평균보다 안정적
- **OOD에서 예측력 유지**

---

## 복잡한 모델의 실패 원인

### LSTM (Deep Learning)
```
시퀀스 패턴 학습 → 게임별 특성 포착 → OOD 취약
```
- v2: CV 13.18 → Public 20.08 (Gap 6.90) ❌
- v3: CV 14.36 → Public 17.29 (Gap 2.93) ❌
- v5: CV 14.44 → Public 17.44 (Gap 3.00) ❌

**근본 원인:**
- 문제의 본질 = "위치 통계" (시퀀스 X)
- 50,000 파라미터 = 과적합 위험
- 새로운 게임 = 새로운 시퀀스 패턴 → 예측 실패

### Phase 2 (GBDT + Features)
```
복잡한 피처 → 학습 데이터 특화 → OOD 취약
```
- CV 15.38 → Public 16.81 (Gap 1.43) ❌

**근본 원인:**
- 피처 분포 변화 (Train vs Test)
- 트리 기반 모델의 외삽 한계
- 게임 ID 27,000 차이 → 분포 이동

---

## 실무 가이드라인

### 1. Gap 예측 규칙

| 접근법 | 예상 Gap | 신뢰도 | 권장 |
|--------|----------|--------|------|
| Zone (Low) | 0.02 ~ 0.15 | 높음 | ✅ 사용 |
| Zone (Medium) | 0.15 ~ 0.30 | 중간 | ⚠️ 주의 |
| GBDT+Features | 1.0 ~ 2.0 | 낮음 | ❌ 비권장 |
| Deep Learning | 2.0 ~ 7.0 | 매우 낮음 | ❌ 금지 |

### 2. 모델 선택 기준

**CV < 16.30 목표 시:**
- Zone 접근법 고수
- 하이퍼파라미터 튜닝만 수행
- **복잡도 증가 금지** ❌

**CV 개선 시도 시:**
- LOGO CV로 검증 필수
- Gap < 0.2 확인 후 제출
- **복잡도 증가 = Gap 증가 경고** ⚠️

**새로운 접근법 시:**
- LOGO CV 먼저 수행
- Zone 6x6와 비교
- **Gap이 커지면 즉시 포기** 🚫

### 3. 검증 프로토콜

```python
# 필수 검증 단계
1. LOGO CV 수행 (198 folds)
2. 게임 간 변동계수 계산 (CoV < 10% 확인)
3. GKF vs LOGO 비교 (차이 < 0.1 확인)
4. Gap 예측 (0.02 ~ 0.15 범위 확인)
5. 제출 결정
```

---

## 결론 및 권장사항

### 핵심 결론

1. **Zone 6x6 = 최적해**
   - CV 16.34, Public 16.36 (Gap 0.028)
   - 게임 간 변동성 9.47% (매우 안정적)
   - OOD 성능 저하 거의 없음 (-0.044)

2. **단순성 > 복잡성**
   - 288 파라미터로 충분
   - 복잡한 모델 = Gap 폭발
   - **"Simplicity is the ultimate sophistication"**

3. **위치 통계 = 안정적**
   - 축구의 물리적 법칙 활용
   - 시간 불변 패턴 학습
   - OOD에 강인

### 권장사항

#### 1. 현재 전략 유지
- ✅ Zone 6x6 고수
- ✅ 미세 튜닝만 수행 (하이퍼파라미터)
- ❌ 복잡도 증가 금지

#### 2. 검증 프로토콜
- ✅ LOGO CV 필수
- ✅ Gap < 0.2 확인
- ✅ 안정성 최우선

#### 3. Week 2-3 관찰
- ✅ 리더보드 모니터링
- ✅ 상위권 접근법 분석
- ✅ Week 4-5 전략 재검토

---

## 부록: 데이터 파일

### 분석 결과
1. **OOD_IMPACT_QUANTIFICATION_REPORT.md** - 상세 보고서 (240줄)
2. **game_level_cv_scores.csv** - 198개 게임별 LOGO CV 점수
3. **cv_public_gap_analysis.csv** - 19개 실험의 CV-Public Gap

### 시각화
1. **1_game_cv_variability.png** - 게임별 CV 변동성 분석
2. **2_cv_public_gap_comparison.png** - 접근법별 Gap 비교
3. **3_complexity_vs_gap.png** - 모델 복잡도 vs Gap
4. **4_logo_vs_gkf.png** - LOGO vs GroupKFold 비교
5. **5_executive_summary.png** - 종합 요약 (테이블 포함)

---

## 핵심 메시지

```
Zone 6x6의 성공은 우연이 아닙니다.

단순성 = 안정성 = OOD 강인성

복잡한 모델로 CV를 낮추는 것은 쉽습니다.
하지만 Public에서 성능을 유지하는 것은 어렵습니다.

Zone 6x6는 이 균형을 완벽하게 달성했습니다.

현재 전략을 유지하세요.
조급함은 금물입니다.
```

---

**분석 완료**
**생성일:** 2025-12-16
**파일 위치:** `/mnt/c/LSJ/dacon/dacon/kleague-algorithm/analysis_results/`
